<div class="container mx-auto px-4 py-8">
  <app-loading *ngIf="loading"></app-loading>

  <div *ngIf="!loading && product" class="animate-fade-in">
    <!-- Breadcrumb -->
    <div class="mb-6 text-sm text-gray-600">
      <a routerLink="/products" class="hover:text-primary-600">Products</a>
      <span class="mx-2">/</span>
      <span>{{product.name}}</span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
      <!-- Images -->
      <div>
        <div class="bg-gray-100 rounded-lg overflow-hidden mb-4 h-96">
          <img 
            [src]="product.images[selectedImage] || 'assets/placeholder.jpg'" 
            [alt]="product.name"
            class="w-full h-full object-contain"
          />
        </div>
        <div class="grid grid-cols-4 gap-2">
          <div *ngFor="let image of product.images; let i = index" 
               (click)="selectImage(i)"
               [class.ring-2]="selectedImage === i"
               [class.ring-primary-600]="selectedImage === i"
               class="bg-gray-100 rounded-lg overflow-hidden cursor-pointer h-20">
            <img [src]="image" [alt]="product.name" class="w-full h-full object-cover">
          </div>
        </div>
      </div>

      <!-- Product Info -->
      <div>
        <h1 class="text-3xl font-bold mb-4">{{product.name}}</h1>
        
        <div class="flex items-center mb-4">
          <div class="flex items-center">
            <span *ngFor="let star of getStars(product.rating)" class="text-yellow-400 text-xl">★</span>
          </div>
          <span class="ml-2 text-gray-600">({{product.numReviews}} reviews)</span>
        </div>

        <div class="text-4xl font-bold text-primary-600 mb-6">
          ${{product.price.toFixed(2)}}
        </div>

        <div class="mb-6">
          <h3 class="font-semibold mb-2">Description:</h3>
          <p class="text-gray-700">{{product.description}}</p>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
          <div>
            <span class="text-gray-600">Category:</span>
            <span class="ml-2 font-semibold">{{product.category}}</span>
          </div>
          <div>
            <span class="text-gray-600">Brand:</span>
            <span class="ml-2 font-semibold">{{product.brand || 'N/A'}}</span>
          </div>
          <div>
            <span class="text-gray-600">Stock:</span>
            <span class="ml-2 font-semibold" [class.text-red-600]="product.stock === 0">
              {{product.stock}} units
            </span>
          </div>
          <div>
            <span class="text-gray-600">Seller:</span>
            <span class="ml-2 font-semibold">{{product.seller.name}}</span>
          </div>
        </div>

        <!-- Quantity Selector -->
        <div class="mb-6">
          <label class="block text-sm font-medium mb-2">Quantity:</label>
          <div class="flex items-center space-x-4">
            <button (click)="decrementQuantity()" class="btn-secondary px-4 py-2">-</button>
            <span class="text-xl font-semibold">{{quantity}}</span>
            <button (click)="incrementQuantity()" [disabled]="quantity >= product.stock" class="btn-secondary px-4 py-2">+</button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex space-x-4 mb-6">
          <button (click)="addToCart()" [disabled]="product.stock === 0" class="btn-primary flex-1">
            Add to Cart
          </button>
          <button (click)="buyNow()" [disabled]="product.stock === 0" class="btn-outline flex-1">
            Buy Now
          </button>
        </div>

        <div *ngIf="product.stock === 0" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
          This product is currently out of stock
        </div>
      </div>
    </div>

    <!-- Reviews Section -->
    <div class="border-t pt-8">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Customer Reviews</h2>
        <button *ngIf="authService.isAuthenticated && !showReviewForm" 
                (click)="showReviewForm = true" 
                class="btn-primary">
          Write a Review
        </button>
      </div>

      <!-- Review Form -->
      <div *ngIf="showReviewForm" class="card mb-6">
        <h3 class="text-xl font-semibold mb-4">Write Your Review</h3>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Rating:</label>
          <div class="flex space-x-2">
            <button *ngFor="let i of [1,2,3,4,5]" 
                    (click)="rating = i"
                    [class.text-yellow-400]="i <= rating"
                    [class.text-gray-300]="i > rating"
                    class="text-3xl">★</button>
          </div>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Comment:</label>
          <textarea [(ngModel)]="comment" rows="4" class="input-field" placeholder="Share your experience..."></textarea>
        </div>
        <div class="flex space-x-4">
          <button (click)="submitReview()" [disabled]="submittingReview || !comment.trim()" class="btn-primary">
            {{submittingReview ? 'Submitting...' : 'Submit Review'}}
          </button>
          <button (click)="showReviewForm = false" class="btn-secondary">Cancel</button>
        </div>
      </div>

      <!-- Reviews List -->
      <div *ngIf="product.reviews.length > 0" class="space-y-4">
        <div *ngFor="let review of product.reviews" class="card">
          <div class="flex justify-between items-start mb-2">
            <div>
              <h4 class="font-semibold">{{review.name}}</h4>
              <div class="flex items-center">
                <span *ngFor="let star of getStars(review.rating)" class="text-yellow-400">★</span>
              </div>
            </div>
            <span class="text-sm text-gray-500">{{review.createdAt | date}}</span>
          </div>
          <p class="text-gray-700">{{review.comment}}</p>
        </div>
      </div>

      <div *ngIf="product.reviews.length === 0" class="text-center py-8 text-gray-500">
        No reviews yet. Be the first to review this product!
      </div>
    </div>
  </div>
</div>
