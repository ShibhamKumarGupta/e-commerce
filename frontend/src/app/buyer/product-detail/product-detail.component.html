<div class="bg-gray-50 min-h-screen">
  <app-loading *ngIf="loading"></app-loading>

  <div *ngIf="!loading && product" class="animate-fade-in">
    <!-- Breadcrumb -->
    <div class="bg-white border-b">
      <div class="container mx-auto px-4 py-3">
        <div class="text-sm text-gray-600">
          <a routerLink="/" class="hover:text-blue-600">Home</a>
          <span class="mx-2">/</span>
          <a routerLink="/products" class="hover:text-blue-600">{{product.category}}</a>
          <span class="mx-2">/</span>
          <span class="text-gray-900">{{product.name}}</span>
        </div>
      </div>
    </div>

    <div class="container mx-auto px-4 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
        <!-- Images -->
        <div>
          <div class="bg-gradient-to-br from-orange-100 to-pink-100 rounded-2xl overflow-hidden mb-4 p-8">
            <img 
              [src]="product.images[selectedImage] || 'assets/placeholder.jpg'" 
              [alt]="product.name"
              class="w-full h-96 object-contain"
            />
          </div>
          <div class="grid grid-cols-4 gap-3">
            <div *ngFor="let image of product.images; let i = index" 
                 (click)="selectImage(i)"
                 [class.ring-2]="selectedImage === i"
                 [class.ring-blue-600]="selectedImage === i"
                 class="bg-gradient-to-br from-orange-50 to-pink-50 rounded-lg overflow-hidden cursor-pointer border-2 border-gray-200 hover:border-blue-400 transition-all">
              <img [src]="image" [alt]="product.name" class="w-full h-20 object-contain p-2">
            </div>
          </div>
        </div>

        <!-- Product Info -->
        <div class="bg-white rounded-2xl p-6 shadow-sm">
          <h1 class="text-3xl font-bold text-gray-900 mb-3">{{product.name}}</h1>
          
          <div class="flex items-center mb-4">
            <div class="flex items-center bg-yellow-50 px-3 py-1 rounded-full">
              <span class="text-yellow-500 text-lg mr-1">★</span>
              <span class="font-semibold text-gray-900">{{product.rating}}</span>
              <span class="text-gray-600 text-sm ml-2">({{product.numReviews}} reviews)</span>
            </div>
          </div>

          <div class="flex items-baseline gap-3 mb-6">
            <div class="text-4xl font-bold text-gray-900">
              ₹{{product.price.toFixed(2)}}
            </div>
            <div class="text-xl text-gray-400 line-through">
              ₹{{(product.price * 1.25).toFixed(2)}}
            </div>
            <div class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-sm font-semibold">
              20% OFF
            </div>
          </div>

          <div class="mb-6">
            <p class="text-gray-700 leading-relaxed">{{product.description}}</p>
          </div>

          <!-- Key Highlights -->
          <div class="mb-6">
            <h3 class="font-semibold text-gray-900 mb-3">Key Highlights</h3>
            <ul class="space-y-2">
              <li class="flex items-start">
                <span class="text-blue-600 mr-2">•</span>
                <span class="text-gray-700">Category: {{product.category}}</span>
              </li>
              <li class="flex items-start">
                <span class="text-blue-600 mr-2">•</span>
                <span class="text-gray-700">Brand: {{product.brand || 'Premium Quality'}}</span>
              </li>
              <li class="flex items-start">
                <span class="text-blue-600 mr-2">•</span>
                <span class="text-gray-700">In Stock: {{product.stock}} units available</span>
              </li>
              <li class="flex items-start">
                <span class="text-blue-600 mr-2">•</span>
                <span class="text-gray-700">Sold by: {{product.seller.name}}</span>
              </li>
            </ul>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-3 mb-6">
            <button 
              (click)="addToCart()" 
              [disabled]="product.stock === 0" 
              class="flex-1 bg-blue-100 text-blue-600 font-semibold py-3 px-6 rounded-lg hover:bg-blue-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              Add to Cart
            </button>
            <button 
              (click)="buyNow()" 
              [disabled]="product.stock === 0" 
              class="flex-1 bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              Buy Now
            </button>
          </div>

          <!-- Delivery Options -->
          <div class="border-t pt-6">
            <h3 class="font-semibold text-gray-900 mb-4">Delivery Options</h3>
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center gap-3 mb-3">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <input type="text" placeholder="Enter Pincode" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">Check</button>
              </div>
            </div>
          </div>

          <div *ngIf="product.stock === 0" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mt-4">
            This product is currently out of stock
          </div>
        </div>
      </div>

      <!-- Reviews & Similar Products Section -->
      <div class="flex gap-8">
        <!-- Reviews Section -->
        <div class="w-2/5 bg-white rounded-2xl p-6 shadow-sm">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Reviews & Ratings</h2>
          
          <!-- Rating Summary -->
          <div class="flex items-center gap-8 mb-8 pb-8 border-b">
            <div class="text-center">
              <div class="text-5xl font-bold text-gray-900 mb-2">{{product.rating}}</div>
              <div class="flex items-center justify-center mb-1">
                <span *ngFor="let star of getStars(product.rating)" class="text-yellow-400 text-xl">★</span>
              </div>
              <div class="text-sm text-gray-600">{{product.numReviews}} ratings</div>
            </div>
            
            <div class="flex-1">
              <div *ngFor="let i of [5,4,3,2,1]" class="flex items-center gap-3 mb-2">
                <span class="text-sm text-gray-600 w-4">{{i}}</span>
                <span class="text-yellow-400">★</span>
                <div class="flex-1 bg-gray-200 rounded-full h-2">
                  <div class="bg-yellow-400 h-2 rounded-full" [style.width.%]="getStarPercentage(i)"></div>
                </div>
                <span class="text-sm text-gray-600 w-8">{{getStarPercentage(i)}}%</span>
              </div>
            </div>
          </div>

          <!-- Write Review Button -->
          <div class="mb-6">
            <button 
              *ngIf="authService.isAuthenticated && !showReviewForm" 
              (click)="showReviewForm = true" 
              class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">
              Write a Review
            </button>
          </div>

          <!-- Review Form -->
          <div *ngIf="showReviewForm" class="bg-gray-50 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-semibold mb-4">Write Your Review</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium mb-2">Rating:</label>
              <div class="flex space-x-2">
                <button *ngFor="let i of [1,2,3,4,5]" 
                        (click)="rating = i"
                        [class.text-yellow-400]="i <= rating"
                        [class.text-gray-300]="i > rating"
                        class="text-3xl hover:scale-110 transition-transform">★</button>
              </div>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium mb-2">Comment:</label>
              <textarea [(ngModel)]="comment" rows="4" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Share your experience..."></textarea>
            </div>
            <div class="flex space-x-4">
              <button (click)="submitReview()" [disabled]="submittingReview || !comment.trim()" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50">
                {{submittingReview ? 'Submitting...' : 'Submit Review'}}
              </button>
              <button (click)="showReviewForm = false" class="bg-gray-200 text-gray-700 font-semibold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">Cancel</button>
            </div>
          </div>

          <!-- Reviews List -->
          <div class="max-h-[600px] overflow-y-auto">
            <div *ngIf="product.reviews.length > 0" class="space-y-4">
              <div *ngFor="let review of product.reviews" class="border-b pb-4 last:border-b-0">
                <div class="flex items-start gap-3 mb-2">
                  <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-semibold">
                    {{review.name.charAt(0).toUpperCase()}}
                  </div>
                  <div class="flex-1">
                    <div class="flex items-center justify-between mb-1">
                      <h4 class="font-semibold text-gray-900">{{review.name}}</h4>
                      <span class="text-sm text-gray-500">{{review.createdAt | date:'MMM d, yyyy'}}</span>
                    </div>
                    <div class="flex items-center mb-2">
                      <span *ngFor="let star of getStars(review.rating)" class="text-yellow-400 text-sm">★</span>
                    </div>
                    <p class="text-gray-700">{{review.comment}}</p>
                    <div class="flex items-center gap-4 mt-3 text-sm">
                      <button class="flex items-center gap-1 text-gray-600 hover:text-blue-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                        </svg>
                        <span>0</span>
                      </button>
                      <button class="flex items-center gap-1 text-gray-600 hover:text-blue-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <span>0</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="product.reviews.length === 0" class="text-center py-8 text-gray-500">
              No reviews yet. Be the first to review this product!
            </div>
          </div>
        </div>

        <!-- Similar Products -->
        <div class="w-3/5 bg-white rounded-2xl p-6 shadow-sm">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Similar Products</h2>
          <div class="grid grid-cols-2 gap-6">
            <a *ngFor="let product of similarProducts" 
              [routerLink]="['/products', product._id]" 
              class="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow group">
              <div class="bg-gradient-to-br from-orange-100 to-pink-100 h-48 flex items-center justify-center p-4">
                <img [src]="product.images[0]" [alt]="product.name" class="h-32 object-contain group-hover:scale-110 transition-transform duration-300">
              </div>
              <div class="p-4">
                <h3 class="font-semibold text-gray-900 mb-1 truncate">{{product.name}}</h3>
                <div class="flex items-center mb-2">
                  <div class="flex items-center">
                    <span class="text-yellow-400 text-sm mr-1">★</span>
                    <span class="text-sm text-gray-600">{{product.rating.toFixed(1)}}</span>
                  </div>
                  <span class="mx-2 text-gray-300">•</span>
                  <span class="text-sm text-gray-600">{{product.numReviews}} reviews</span>
                </div>
                <div class="text-lg font-bold text-gray-900">₹{{product.price.toFixed(2)}}</div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
