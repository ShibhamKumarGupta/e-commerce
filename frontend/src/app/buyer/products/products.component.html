<div class="page-shell-light pt-20">
  <!-- Loading Overlay -->
  <div *ngIf="loading" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/70 backdrop-blur">
    <div class="glass-card px-10 py-8 text-center text-slate-900">
      <div class="mx-auto h-14 w-14 animate-spin rounded-full border-4 border-slate-200 border-t-primary-500"></div>
      <p class="mt-4 text-sm font-semibold tracking-wide text-slate-500 uppercase">Loading Products…</p>
    </div>
  </div>

  <!-- Content -->
  <section class="pb-16">
    <div class="page-container grid gap-8 mt-10 lg:grid-cols-[320px,1fr]">
      <!-- Filters -->
      <aside class="space-y-6">
        <div class="rounded-3xl border border-slate-200 bg-white p-8 shadow-xl lg:sticky lg:top-28 ">
          <div class="flex items-start justify-between">
            <div>
              <h2 class="text-xl font-semibold text-slate-900">Filters</h2>
              <p class="text-sm text-slate-500">Dial in products to match your exact flow.</p>
            </div>
            <button (click)="clearFilters()" type="button" class="text-sm font-medium text-primary-600 hover:text-primary-700">
              Reset
            </button>
          </div>

          <div class="mt-8 space-y-4">
            <!-- Category -->
            <div>
              <h3 class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Category</h3>
              <div class="mt-4 space-y-2">
                <label class="group flex cursor-pointer items-center gap-3 rounded-xl border border-transparent px-3 py-2 transition hover:border-primary-200 hover:bg-primary-50">
                  <input type="radio" name="category" value="" [(ngModel)]="selectedCategory" (change)="onCategoryChange()" class="h-4 w-4 rounded-full text-primary-600 focus:ring-primary-500" />
                  <span class="text-sm font-medium text-slate-600 group-hover:text-primary-600">All categories</span>
                </label>
                <label
                  *ngFor="let category of categories"
                  class="group flex cursor-pointer items-center gap-3 rounded-xl border border-transparent px-3 py-2 capitalize transition hover:border-primary-200 hover:bg-primary-50">
                  <input type="radio" name="category" [value]="category.slug" [(ngModel)]="selectedCategory" (change)="onCategoryChange()" class="h-4 w-4 rounded-full text-primary-600 focus:ring-primary-500" />
                  <span class="flex items-center gap-2 text-sm font-medium text-slate-600 group-hover:text-primary-600">
                    <span *ngIf="category.iconSafeHtml" class="flex h-6 w-6 items-center justify-center rounded-lg bg-primary-50 text-primary-500" [innerHTML]="category.iconSafeHtml"></span>
                    <span *ngIf="!category.iconSafeHtml" class="flex h-6 w-6 items-center justify-center rounded-lg bg-primary-50 text-xs font-semibold text-primary-600">
                      {{category.name.charAt(0).toUpperCase()}}
                    </span>
                    {{category.name}}
                  </span>
                </label>
              </div>
            </div>

            <!-- Price -->
            <div>
              <h3 class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Price range</h3>
              <div class="mt-4 space-y-4">
                <div>
                  <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">Min</label>
                  <div class="mt-1 flex items-center rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2">
                    <span class="text-sm text-slate-400">₹</span>
                    <input type="number" [(ngModel)]="minPrice" (change)="onCategoryChange()" placeholder="0" class="ml-2 w-full border-none bg-transparent text-sm text-slate-600 outline-none" />
                  </div>
                </div>
                <div>
                  <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">Max</label>
                  <div class="mt-1 flex items-center rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2">
                    <span class="text-sm text-slate-400">₹</span>
                    <input type="number" [(ngModel)]="maxPrice" (change)="onCategoryChange()" placeholder="5000" class="ml-2 w-full border-none bg-transparent text-sm text-slate-600 outline-none" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Rating -->
            <!-- <div>
              <h3 class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Rating</h3>
              <div class="mt-4 space-y-2">
                <label class="group flex cursor-pointer items-center gap-3 rounded-xl border border-transparent px-3 py-2 transition hover:border-primary-200 hover:bg-primary-50">
                  <input type="radio" name="rating" value="" [(ngModel)]="minRating" (change)="onCategoryChange()" class="h-4 w-4 text-primary-600 focus:ring-primary-500" />
                  <span class="text-sm font-medium text-slate-600 group-hover:text-primary-600">Any rating</span>
                </label>
                <label class="group flex cursor-pointer items-center gap-3 rounded-xl border border-transparent px-3 py-2 transition hover:border-primary-200 hover:bg-primary-50">
                  <input type="radio" name="rating" value="4" [(ngModel)]="minRating" (change)="onCategoryChange()" class="h-4 w-4 text-primary-600 focus:ring-primary-500" />
                  <span class="text-sm font-medium text-slate-600 group-hover:text-primary-600">4 stars & up</span>
                </label>
                <label class="group flex cursor-pointer items-center gap-3 rounded-xl border border-transparent px-3 py-2 transition hover:border-primary-200 hover:bg-primary-50">
                  <input type="radio" name="rating" value="3" [(ngModel)]="minRating" (change)="onCategoryChange()" class="h-4 w-4 text-primary-600 focus:ring-primary-500" />
                  <span class="text-sm font-medium text-slate-600 group-hover:text-primary-600">3 stars & up</span>
                </label>
              </div>
            </div> -->
          </div>
        </div>

      </aside>

      <!-- Main Content -->
      <div class="rounded-3xl border border-slate-200 bg-white p-8 shadow-xl">
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-xl font-semibold text-slate-900">Products</h2>
              <p class="text-sm text-slate-500">Showing {{products.length}} of {{totalProducts}} curated items</p>
            </div>
            <div class="flex items-center gap-3">
              <label class="text-sm font-medium text-slate-500">Sort by</label>
              <div class="relative">
                <select [(ngModel)]="sortBy" (change)="onSortChange()" class="appearance-none rounded-full border border-slate-200 bg-slate-50 py-2 pl-4 pr-10 text-sm font-medium text-slate-700 focus:border-primary-300 focus:outline-none">
                  <option value="price">Price</option>
                  <option value="rating">Popularity</option>
                  <option value="createdAt">Newest</option>
                </select>
                <svg class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Products -->
          <div *ngIf="!loading && products.length > 0" class="mt-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-2">
            <div
              *ngFor="let product of products"
              class="group flex h-full flex-col overflow-hidden rounded-3xl border border-slate-100 bg-gradient-to-br from-white to-slate-50 shadow-xl transition duration-300 hover:-translate-y-2 hover:shadow-2xl">
              <a [routerLink]="['/products', product._id]" class="relative block overflow-hidden">
                <img
                  [src]="product.images && product.images[0] || 'https://via.placeholder.com/400x400?text=No+Image'"
                  [alt]="product.name"
                  class="h-64 w-full object-cover transition duration-500 group-hover:scale-105"
                  onerror="this.src='https://via.placeholder.com/400x400?text=No+Image'" />
                <div *ngIf="product.stock === 0" class="absolute inset-0 flex items-center justify-center bg-slate-900/60">
                  <span class="rounded-full bg-red-500 px-4 py-1 text-sm font-semibold text-white">Out of stock</span>
                </div>
                <div *ngIf="product.stock > 0 && product.stock < 10" class="absolute left-4 top-4 rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700">
                  Only {{product.stock}} left
                </div>
              </a>
              <div class="flex flex-1 flex-col gap-4 p-6">
                <div class="flex items-start justify-between gap-4">
                  <a [routerLink]="['/products', product._id]" class="text-lg font-semibold text-slate-900 transition hover:text-primary-600 line-clamp-2">
                    {{product.name}}
                  </a>
                  <div class="flex items-center gap-1 rounded-full bg-primary-50 px-3 py-1 text-xs font-semibold text-primary-600">
                    ★ {{product.rating.toFixed(1) || '0.0'}}
                  </div>
                </div>
                <p class="text-sm text-slate-500 line-clamp-2">{{product.description}}</p>
                <div class="mt-auto flex items-center justify-between">
                  <div>
                    <p class="text-xs uppercase tracking-wide text-slate-400">Price</p>
                    <p class="text-2xl font-bold text-slate-900">₹{{product.price.toFixed(2) || '0.00'}}</p>
                  </div>
                  <span [class]="'rounded-full px-3 py-1 text-xs font-semibold ' + (product.stock > 10 ? 'bg-emerald-100 text-emerald-700' : product.stock > 0 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700')">
                    {{product.stock > 10 ? 'In stock' : product.stock > 0 ? 'Low stock' : 'Out of stock'}}
                  </span>
                </div>
                <button
                  (click)="addToCart(product); $event.stopPropagation()"
                  [disabled]="product.stock === 0"
                  class="inline-flex items-center justify-center gap-2 rounded-full bg-primary-600 px-5 py-3 text-sm font-semibold text-white shadow-lg transition hover:bg-primary-700 disabled:cursor-not-allowed disabled:bg-slate-300">
                  <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                  {{product.stock === 0 ? 'Unavailable' : 'Add to cart'}}
                </button>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="!loading && products.length === 0" class="mt-12 rounded-3xl border border-dashed border-slate-300 bg-slate-50 py-16 text-center">
            <div class="mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-white shadow">
              <svg class="h-10 w-10 text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-2.293 2.293a1 1 0 00.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4m-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </div>
            <h3 class="mt-6 text-2xl font-semibold text-slate-900">No products match these filters</h3>
            <p class="mt-2 text-sm text-slate-500">Adjust your filters or clear them to see the full catalogue.</p>
            <button (click)="clearFilters()" class="mt-6 inline-flex items-center justify-center gap-2 rounded-full border border-primary-600 px-6 py-3 text-sm font-semibold text-primary-600 transition hover:bg-primary-600 hover:text-white">
              Reset filters
            </button>
          </div>

          <!-- Pagination -->
          <div *ngIf="!loading && totalPages > 1" class="mt-12 flex flex-wrap items-center justify-center gap-3">
            <button
              (click)="onPageChange(currentPage - 1)"
              [disabled]="currentPage === 1"
              class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-slate-200 text-slate-500 transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-40">
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
            <div class="flex flex-wrap items-center gap-2">
              <button
                *ngFor="let page of pages.slice(0, 10)"
                (click)="onPageChange(page)"
                [class]="'inline-flex h-11 w-11 items-center justify-center rounded-full text-sm font-semibold transition ' + (page === currentPage ? 'bg-primary-600 text-white shadow-lg' : 'border border-slate-200 text-slate-600 hover:bg-slate-100')">
                {{page}}
              </button>
              <span *ngIf="totalPages > 10" class="text-sm font-medium text-slate-500">…</span>
            </div>
            <button
              (click)="onPageChange(currentPage + 1)"
              [disabled]="currentPage === totalPages"
              class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-slate-200 text-slate-500 transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-40">
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
      </div>
    </div>
  </section>
</div>
