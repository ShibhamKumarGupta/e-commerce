<div class="page-shell-light pt-20">
  <div class="page-container">
    <div class="mx-auto max-w-6xl space-y-10 py-12">
      <div class="flex flex-wrap items-center justify-between gap-6 rounded-3xl border border-primary-200/60 bg-gradient-to-r from-primary-500/10 via-white to-sky-400/10 p-8 shadow-xl shadow-primary-500/20">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.4em] text-primary-500">Checkout</p>
          <h1 class="mt-3 text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">Finalize your experience</h1>
          <p class="mt-3 max-w-xl text-sm text-slate-600 sm:text-base">Confirm your address and preferred payment method to complete this futuristic delivery.</p>
        </div>
        <div class="rounded-2xl bg-white/80 p-6 shadow-lg shadow-primary-500/10 backdrop-blur">
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Total payable</p>
          <p class="mt-2 text-3xl font-semibold text-slate-900">â‚¹{{totalAmount.toFixed(2)}}</p>
          <p class="text-xs text-slate-400">Taxes & shipping included</p>
        </div>
      </div>

      <div class="grid gap-8 lg:grid-cols-[minmax(0,2.1fr),minmax(0,1fr)]">
        <form [formGroup]="checkoutForm" class="space-y-8">
          <div class="rounded-3xl border border-slate-200/70 bg-white/90 p-8 shadow-xl shadow-primary-500/10 backdrop-blur">
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div>
                <h2 class="text-2xl font-semibold text-slate-900">Shipping address</h2>
                <p class="text-sm text-slate-500">Tell us where to deliver your order.</p>
              </div>
              <span class="rounded-full bg-primary-50 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-primary-600">Secure delivery</span>
            </div>

            <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2">
              <div class="md:col-span-2">
                <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">Street address *</label>
                <input formControlName="street" type="text" placeholder="123 Main Street" class="mt-2 w-full rounded-2xl border border-slate-200/80 bg-white/70 px-4 py-3 text-sm text-slate-700 shadow-sm transition focus:border-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-200" />
                <div *ngIf="checkoutForm.get('street')?.invalid && checkoutForm.get('street')?.touched" class="mt-2 text-xs text-red-500">
                  <span *ngIf="checkoutForm.get('street')?.errors?.['required']">Street address is required</span>
                  <span *ngIf="checkoutForm.get('street')?.errors?.['minlength']">Street address must be at least 5 characters</span>
                </div>
              </div>

              <div>
                <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">City *</label>
                <input formControlName="city" type="text" placeholder="New York" class="mt-2 w-full rounded-2xl border border-slate-200/80 bg-white/70 px-4 py-3 text-sm text-slate-700 shadow-sm transition focus:border-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-200" />
                <div *ngIf="checkoutForm.get('city')?.invalid && checkoutForm.get('city')?.touched" class="mt-2 text-xs text-red-500">
                  <span *ngIf="checkoutForm.get('city')?.errors?.['required']">City is required</span>
                  <span *ngIf="checkoutForm.get('city')?.errors?.['minlength']">City must be at least 2 characters</span>
                </div>
              </div>

              <div>
                <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">State *</label>
                <input formControlName="state" type="text" placeholder="NY" class="mt-2 w-full rounded-2xl border border-slate-200/80 bg-white/70 px-4 py-3 text-sm text-slate-700 shadow-sm transition focus:border-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-200" />
                <div *ngIf="checkoutForm.get('state')?.invalid && checkoutForm.get('state')?.touched" class="mt-2 text-xs text-red-500">
                  <span *ngIf="checkoutForm.get('state')?.errors?.['required']">State is required</span>
                  <span *ngIf="checkoutForm.get('state')?.errors?.['minlength']">State must be at least 2 characters</span>
                </div>
              </div>

              <div>
                <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">ZIP code *</label>
                <input formControlName="zipCode" type="text" placeholder="10001" class="mt-2 w-full rounded-2xl border border-slate-200/80 bg-white/70 px-4 py-3 text-sm text-slate-700 shadow-sm transition focus:border-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-200" />
                <div *ngIf="checkoutForm.get('zipCode')?.invalid && checkoutForm.get('zipCode')?.touched" class="mt-2 text-xs text-red-500">
                  <span *ngIf="checkoutForm.get('zipCode')?.errors?.['required']">ZIP code is required</span>
                  <span *ngIf="checkoutForm.get('zipCode')?.errors?.['pattern']">Enter a valid ZIP code (5-10 digits)</span>
                </div>
              </div>

              <div>
                <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">Country *</label>
                <input formControlName="country" type="text" placeholder="USA" class="mt-2 w-full rounded-2xl border border-slate-200/80 bg-white/70 px-4 py-3 text-sm text-slate-700 shadow-sm transition focus:border-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-200" />
                <div *ngIf="checkoutForm.get('country')?.invalid && checkoutForm.get('country')?.touched" class="mt-2 text-xs text-red-500">
                  <span *ngIf="checkoutForm.get('country')?.errors?.['required']">Country is required</span>
                  <span *ngIf="checkoutForm.get('country')?.errors?.['minlength']">Country must be at least 2 characters</span>
                </div>
              </div>

              <div class="md:col-span-2">
                <label class="text-xs font-semibold uppercase tracking-wide text-slate-400">Phone number *</label>
                <input formControlName="phone" type="tel" placeholder="+1 234 567 8900" class="mt-2 w-full rounded-2xl border border-slate-200/80 bg-white/70 px-4 py-3 text-sm text-slate-700 shadow-sm transition focus:border-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-200" />
                <div *ngIf="checkoutForm.get('phone')?.invalid && checkoutForm.get('phone')?.touched" class="mt-2 text-xs text-red-500">
                  <span *ngIf="checkoutForm.get('phone')?.errors?.['required']">Phone number is required</span>
                  <span *ngIf="checkoutForm.get('phone')?.errors?.['pattern']">Enter a valid phone number (10-15 digits)</span>
                </div>
              </div>
            </div>
          </div>

          <div class="rounded-3xl border border-slate-200/70 bg-white/90 p-8 shadow-xl shadow-primary-500/10 backdrop-blur">
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div>
                <h2 class="text-2xl font-semibold text-slate-900">Payment method</h2>
                <p class="text-sm text-slate-500">Choose how you'd like to complete your purchase.</p>
              </div>
              <span class="rounded-full bg-slate-900 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-white">Secure gateway</span>
            </div>

            <div class="mt-6 space-y-4">
              <label class="group flex items-start gap-4 rounded-2xl border border-slate-200/80 bg-white/70 p-5 transition hover:border-primary-200 hover:bg-primary-50/40">
                <input type="radio" name="payment" [value]="PaymentMethod.COD" [(ngModel)]="paymentMethod" [ngModelOptions]="{ standalone: true }" class="mt-1 h-4 w-4 text-primary-600 focus:ring-primary-500" />
                <div>
                  <div class="text-sm font-semibold text-slate-900">Cash on delivery</div>
                  <p class="text-xs text-slate-500">Complete payment when the order arrives at your doorstep.</p>
                </div>
              </label>

              <label class="group flex items-start gap-4 rounded-2xl border border-slate-200/80 bg-white/70 p-5 transition hover:border-primary-200 hover:bg-primary-50/40">
                <input type="radio" name="payment" [value]="PaymentMethod.STRIPE" [(ngModel)]="paymentMethod" [ngModelOptions]="{ standalone: true }" class="mt-1 h-4 w-4 text-primary-600 focus:ring-primary-500" />
                <div>
                  <div class="text-sm font-semibold text-slate-900">Credit / Debit card</div>
                  <p class="text-xs text-slate-500">You will be securely redirected to Stripe to authorize your payment.</p>
                </div>
              </label>
            </div>

            <div *ngIf="paymentMethod === PaymentMethod.STRIPE" class="mt-6 rounded-2xl border border-primary-200 bg-primary-50/70 p-5 text-sm text-primary-700">
              <div class="flex items-start gap-3">
                <svg class="mt-0.5 h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="font-semibold">Secure payment ahead</p>
                  <p class="mt-1 text-xs leading-relaxed">You will be redirected to Stripe to authenticate this transaction. Once confirmed, you'll land right back here with instant order status updates.</p>
                </div>
              </div>
            </div>
          </div>
        </form>

        <div class="space-y-6">
          <div class="rounded-3xl border border-slate-200/70 bg-white/90 p-8 shadow-xl shadow-primary-500/10 backdrop-blur lg:sticky lg:top-6">
            <h2 class="text-2xl font-semibold text-slate-900">Order summary</h2>
            <p class="mt-2 text-sm text-slate-500">A quick glance at everything in your bag.</p>

            <div class="mt-6 space-y-4 max-h-56 overflow-y-auto pr-1">
              <div *ngIf="cart.items.length === 0" class="rounded-2xl border border-dashed border-slate-200/80 bg-white/60 px-4 py-8 text-center text-sm text-slate-400">
                Your cart is currently empty.
              </div>
              <div *ngFor="let item of cart.items" class="flex items-start justify-between gap-3 rounded-2xl border border-white/40 bg-white/70 px-4 py-3 text-sm text-slate-600 shadow-sm">
                <div class="flex-1">
                  <p class="font-semibold text-slate-900 line-clamp-2">{{item.product.name}}</p>
                  <p class="text-xs text-slate-400">Qty {{item.quantity}}</p>
                </div>
                <span class="font-semibold text-slate-900">â‚¹{{(item.product.price * item.quantity).toFixed(2)}}</span>
              </div>
            </div>

            <div class="mt-6 space-y-3 text-sm text-slate-500">
              <div class="flex items-center justify-between">
                <span>Subtotal</span>
                <span class="font-semibold text-slate-900">â‚¹{{cart.totalPrice.toFixed(2)}}</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Shipping</span>
                <span class="font-semibold text-slate-900">â‚¹{{cart.totalPrice > 100 ? '0.00' : '10.00'}}</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Tax (10%)</span>
                <span class="font-semibold text-slate-900">â‚¹{{(cart.totalPrice * 0.1).toFixed(2)}}</span>
              </div>
            </div>

            <div class="mt-4 rounded-2xl bg-slate-900 px-5 py-4 text-white shadow-inner">
              <div class="flex items-center justify-between text-base font-semibold">
                <span>Total</span>
                <span>â‚¹{{totalAmount.toFixed(2)}}</span>
              </div>
              <p class="mt-1 text-xs text-slate-300">Includes applicable duties and taxes.</p>
            </div>

            <button type="button" (click)="placeOrder()" [disabled]="loading || checkoutForm.invalid" class="btn-primary mt-6 w-full rounded-full py-3 text-sm font-semibold">
              {{loading ? 'Processing...' : 'Place secure order'}}
            </button>

            <p class="mt-3 text-xs text-slate-400">By placing this order, you agree to our terms of service and privacy policy.</p>
          </div>

          <div class="rounded-3xl border border-white/20 bg-gradient-to-r from-primary-500/20 to-sky-400/20 p-6 text-sm text-slate-700 shadow-lg shadow-primary-500/10">
            <h3 class="text-sm font-semibold uppercase tracking-[0.3em] text-slate-500">Need help?</h3>
            <p class="mt-3 text-sm text-slate-600">Our concierge team is available 24/7 to assist with order updates, delivery preferences, and payment queries.</p>
            <a href="mailto:support@omnicart.ai" class="mt-3 inline-flex items-center gap-2 text-sm font-semibold text-primary-700">
              support&#64;omnicart.ai
              <span class="text-xs">â†—</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
